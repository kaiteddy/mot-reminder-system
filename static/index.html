<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI MOT Assistant - Intelligent Vehicle Management</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/unified-design-system.css?v=2024010401">
    <style>
        /* Page visibility and transitions */
        body {
            visibility: visible !important;
            opacity: 1 !important;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        #dashboard-page {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Main content layout */
        .main-content {
            min-height: calc(100vh - 80px);
            padding: var(--space-6) 0;
        }

        /* Navigation enhancements */
        .apple-nav-links a.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        /* Insights grid layout */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-8);
        }

        /* Enhanced status indicators */
        .status-critical {
            background: rgba(255, 59, 48, 0.1);
            color: var(--color-danger);
            border: 1px solid rgba(255, 59, 48, 0.2);
        }
        .status-high {
            background: rgba(255, 149, 0, 0.1);
            color: var(--color-warning);
            border: 1px solid rgba(255, 149, 0, 0.2);
        }
        .status-medium {
            background: rgba(255, 204, 0, 0.1);
            color: #FFCC00;
            border: 1px solid rgba(255, 204, 0, 0.2);
        }
        .status-low {
            background: rgba(52, 199, 89, 0.1);
            color: var(--color-success);
            border: 1px solid rgba(52, 199, 89, 0.2);
        }

        /* Loading states */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-8);
            color: var(--color-text-tertiary);
            gap: var(--space-3);
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            .main-content {
                padding: var(--space-4) 0;
            }

            .insights-grid {
                grid-template-columns: 1fr;
                gap: var(--space-3);
            }
        }
    </style>
</head>
<body style="visibility: visible; opacity: 1;">
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="#" class="navbar-brand">
                <i class="fas fa-car"></i>
                MOT Assistant
            </a>
            <ul class="nav-links">
                <li><a href="#" data-page="dashboard" class="nav-link active" onclick="showPageDirect('dashboard'); return false;">Dashboard</a></li>
                <li><a href="#" data-page="vehicles" class="nav-link" onclick="showPageDirect('vehicles'); return false;">Vehicles</a></li>
                <li><a href="#" data-page="customers" class="nav-link" onclick="showPageDirect('customers'); return false;">Customers</a></li>
                <li><a href="/service-history" class="nav-link" target="_blank">Service History</a></li>
                <li><a href="/parts" class="nav-link" target="_blank">Parts</a></li>
                <li><a href="#" data-page="reminders" class="nav-link" onclick="showPageDirect('reminders'); return false;">Reminders</a></li>
                <li><a href="#" data-page="job-sheets" class="nav-link" onclick="showPageDirect('job-sheets'); return false;">Job Sheets</a></li>
                <li><a href="#" data-page="settings" class="nav-link" onclick="showPageDirect('settings'); return false;">Settings</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div class="main-content">
                <!-- Dashboard Page -->
                <div class="page" id="dashboard-page">
                    <!-- Page Header -->
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-tachometer-alt" style="color: var(--color-primary);"></i>
                            MOT Intelligence Center
                        </h1>
                        <p class="page-subtitle">Advanced vehicle monitoring and predictive maintenance insights</p>
                    </div>

                    <!-- AI Insights Card -->
                    <div class="apple-card" style="margin-bottom: var(--apple-spacing-lg);">
                        <div class="apple-card-header">
                            <h2 class="apple-card-title">
                                <i class="fas fa-lightbulb" style="color: var(--apple-orange);"></i>
                                AI Insights & Recommendations
                            </h2>
                        </div>
                        <div class="apple-card-body">
                            <div id="ai-insights-content">
                                <div style="text-align: center; color: var(--apple-text-tertiary);">
                                    <i class="fas fa-spinner fa-spin"></i> Analyzing your data to generate insights...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="apple-grid apple-grid-3" style="margin-bottom: var(--apple-spacing-lg);">
                        <div class="apple-card">
                            <div class="apple-card-body" style="text-align: center;">
                                <div style="font-size: 48px; font-weight: var(--apple-font-weight-bold); color: var(--apple-blue); margin-bottom: var(--apple-spacing-sm);" id="reminders-due-count">0</div>
                                <div style="color: var(--apple-text-secondary); margin-bottom: var(--apple-spacing-md);">
                                    <i class="fas fa-brain"></i> AI Predictions
                                </div>
                                <button class="apple-btn apple-btn-primary" id="process-reminders-btn">
                                    <i class="fas fa-magic"></i> Process with AI
                                </button>
                            </div>
                        </div>
                        <div class="apple-card">
                            <div class="apple-card-body" style="text-align: center;">
                                <div style="font-size: 48px; font-weight: var(--apple-font-weight-bold); color: var(--apple-green); margin-bottom: var(--apple-spacing-sm);" id="vehicles-count">0</div>
                                <div style="color: var(--apple-text-secondary); margin-bottom: var(--apple-spacing-md);">
                                    <i class="fas fa-car"></i> Smart Fleet
                                </div>
                                <button class="apple-btn apple-btn-success" id="schedule-reminders-btn">
                                    <i class="fas fa-calendar-alt"></i> Auto Schedule
                                </button>
                            </div>
                        </div>
                        <div class="apple-card">
                            <div class="apple-card-body" style="text-align: center;">
                                <div style="font-size: 48px; font-weight: var(--apple-font-weight-bold); color: var(--apple-purple); margin-bottom: var(--apple-spacing-sm);" id="customers-count">0</div>
                                <div style="color: var(--apple-text-secondary); margin-bottom: var(--apple-spacing-md);">
                                    <i class="fas fa-users"></i> Customer Hub
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reminders Table -->
                    <div class="apple-card">
                        <div class="apple-card-header">
                            <h2 class="apple-card-title">
                                <i class="fas fa-brain" style="color: var(--apple-blue);"></i>
                                AI-Powered Reminder Intelligence
                            </h2>
                        </div>
                        <div class="apple-table-container">
                            <table class="apple-table">
                                <thead>
                                    <tr>
                                        <th>Registration</th>
                                        <th>Customer</th>
                                        <th>MOT Expiry</th>
                                        <th>Days Left</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="due-reminders-table">
                                    <!-- Reminders will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Vehicles Page -->
                <div class="page" id="vehicles-page" style="display: none;">
                    <!-- Page Header -->
                    <div class="apple-page-header">
                        <h1 class="apple-page-title">
                            <i class="fas fa-car" style="color: var(--apple-blue); margin-right: 12px;"></i>
                            Vehicles
                        </h1>
                        <p class="apple-page-subtitle">Manage your vehicle fleet with DVLA integration</p>
                    </div>

                    <!-- Action Bar -->
                    <div class="apple-action-bar">
                        <div></div>
                        <div class="apple-action-group">
                            <button class="apple-btn apple-btn-secondary" id="upload-csv-btn">
                                <i class="bi bi-upload"></i> Upload File
                            </button>
                            <button class="apple-btn apple-btn-danger" id="clear-all-vehicles-btn">
                                <i class="bi bi-trash"></i> Clear All
                            </button>
                            <button class="apple-btn apple-btn-primary" id="add-vehicle-btn">
                                <i class="bi bi-plus"></i> Add Vehicle
                            </button>
                        </div>
                    </div>

                    <!-- CSV Upload Section -->
                    <div id="csv-upload-section" style="display: none; margin-bottom: var(--apple-spacing-lg);">
                        <div class="apple-card">
                            <div class="apple-card-header">
                                <h2 class="apple-card-title">Upload Vehicle File (CSV/Excel)</h2>
                            </div>
                            <div class="apple-card-body">
                                <div style="margin-bottom: var(--apple-spacing-md);">
                                    <input type="file" style="width: 100%; padding: var(--apple-spacing-sm); border: 1px solid var(--apple-separator); border-radius: var(--apple-radius-medium);" id="csv-file-input" accept=".csv,.xlsx,.xls">
                                    <div style="margin-top: var(--apple-spacing-sm); font-size: 14px; color: var(--apple-text-tertiary);">
                                        <strong>Enhanced File Upload with DVLA Auto-Lookup:</strong><br>
                                        • <strong>Supported formats:</strong> CSV (.csv) and Excel (.xlsx, .xls)<br>
                                        • <strong>Required:</strong> registration<br>
                                        • <strong>Optional:</strong> make, model, color, year, mot_expiry, customer_name, customer_email, customer_phone<br>
                                        • System will automatically lookup and verify all registrations against DVLA database<br>
                                        • DVLA data takes precedence over file data for accuracy<br>
                                        • Missing vehicle details will be auto-populated from DVLA
                                    </div>
                                </div>
                                <div style="display: flex; gap: var(--apple-spacing-sm);">
                                    <button class="apple-btn apple-btn-primary" id="process-csv-btn">Process File</button>
                                    <button class="apple-btn apple-btn-secondary" id="cancel-csv-btn">Cancel</button>
                                    <button class="apple-btn apple-btn-secondary" id="download-csv-template">CSV Template</button>
                                    <button class="apple-btn apple-btn-secondary" id="download-excel-template">Excel Template</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Vehicles Table -->
                    <div class="apple-table-container">
                        <table class="apple-table">
                            <thead>
                                <tr>
                                    <th>Registration</th>
                                    <th>Make</th>
                                    <th>Model</th>
                                    <th>Customer</th>
                                    <th>MOT Expiry</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vehicles-table">
                                <!-- Vehicles will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Customers Page -->
                <div class="page" id="customers-page" style="display: none;">
                    <!-- Page Header -->
                    <div class="apple-page-header">
                        <h1 class="apple-page-title">
                            <i class="fas fa-users" style="color: var(--apple-blue); margin-right: 12px;"></i>
                            Customers
                        </h1>
                        <p class="apple-page-subtitle">Manage your customer database</p>
                    </div>

                    <!-- Action Bar -->
                    <div class="apple-action-bar">
                        <div></div>
                        <div class="apple-action-group">
                            <button class="apple-btn apple-btn-primary" id="add-customer-btn">
                                <i class="bi bi-plus"></i> Add Customer
                            </button>
                        </div>
                    </div>

                    <!-- Customers Table -->
                    <div class="apple-table-container">
                        <table class="apple-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Vehicles</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customers-table">
                                <!-- Customers will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Reminders Page -->
                <div class="page" id="reminders-page" style="display: none;">
                    <!-- Page Header -->
                    <div class="apple-page-header">
                        <h1 class="apple-page-title">
                            <i class="fas fa-bell" style="color: var(--apple-blue); margin-right: 12px;"></i>
                            MOT Reminders
                        </h1>
                        <p class="apple-page-subtitle">Manage and send MOT expiry reminders to customers</p>
                    </div>

                    <!-- Action Bar -->
                    <div class="apple-action-bar">
                        <div class="apple-action-group">
                            <button class="apple-btn apple-btn-secondary" id="review-mode-btn">
                                <i class="bi bi-eye"></i> Review Mode
                            </button>
                            <button class="apple-btn apple-btn-warning" id="cleanup-invalid-reminders-btn" title="Remove invalid reminders and regenerate with DVLA verification">
                                <i class="fas fa-broom"></i> DVLA Cleanup
                            </button>
                        </div>
                        <div class="apple-action-group">
                            <button class="apple-btn apple-btn-danger" id="clear-all-reminders-btn">
                                <i class="bi bi-trash"></i> Clear All
                            </button>
                            <button class="apple-btn apple-btn-primary" id="add-reminder-btn">
                                <i class="bi bi-plus"></i> Add Reminder
                            </button>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="apple-filter-bar" id="reminder-filters">
                        <div class="apple-filter-grid">
                            <div class="apple-filter-group">
                                <label class="apple-filter-label">Urgency</label>
                                <select class="apple-select" id="urgency-filter">
                                    <option value="">All Urgencies</option>
                                    <option value="critical">🔴 Critical (Expired/Today)</option>
                                    <option value="high">🟠 High (1-7 days)</option>
                                    <option value="medium">🟡 Medium (8-30 days)</option>
                                    <option value="low">🟢 Low (30+ days)</option>
                                </select>
                            </div>
                            <div class="apple-filter-group">
                                <label class="apple-filter-label">Status</label>
                                <select class="apple-select" id="status-filter">
                                    <option value="">All Statuses</option>
                                    <option value="scheduled">📅 Scheduled</option>
                                    <option value="sent">✅ Sent</option>
                                    <option value="failed">❌ Failed</option>
                                    <option value="archived">📁 Archived</option>
                                </select>
                            </div>
                            <div class="apple-filter-group">
                                <label class="apple-filter-label">Sort By</label>
                                <select class="apple-select" id="sort-by">
                                    <option value="days_asc">⚡ Days Until Expiry (Urgent First)</option>
                                    <option value="days_desc">📅 Days Until Expiry (Future First)</option>
                                    <option value="registration">🔤 Registration</option>
                                    <option value="make">🚗 Make/Model</option>
                                </select>
                            </div>
                            <div class="apple-filter-group">
                                <label class="apple-filter-label">Search</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="text" class="apple-input" id="search-vehicles" placeholder="Search vehicles..." style="flex: 1;">
                                    <button class="apple-btn apple-btn-secondary" type="button" id="clear-search">
                                        <i class="bi bi-x"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bulk Actions -->
                    <div class="apple-card" id="bulk-actions" style="display: none; margin-bottom: var(--apple-spacing-lg);">
                        <div class="apple-card-body" style="padding: var(--apple-spacing-md);">
                            <div class="apple-action-bar" style="margin: 0;">
                                <div style="display: flex; align-items: center; gap: var(--apple-spacing-md);">
                                    <span id="selected-count" style="font-weight: var(--apple-font-weight-medium); color: var(--apple-text-secondary);">0 selected</span>
                                </div>
                                <div class="apple-action-group">
                                    <button class="apple-btn apple-btn-success" id="bulk-send-btn">
                                        <i class="bi bi-send"></i> Send Selected
                                    </button>
                                    <button class="apple-btn apple-btn-warning" id="bulk-archive-btn">
                                        <i class="bi bi-archive"></i> Archive Selected
                                    </button>
                                    <button class="apple-btn apple-btn-danger" id="bulk-delete-btn">
                                        <i class="bi bi-trash"></i> Delete Selected
                                    </button>
                                    <button class="apple-btn apple-btn-secondary" id="clear-selection-btn">
                                        Clear Selection
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reminders Table -->
                    <div class="apple-table-container">
                        <table class="apple-table apple-table-compact">
                            <thead>
                                <tr>
                                    <th style="width: 40px;">
                                        <input type="checkbox" id="select-all-reminders" style="margin: 0;">
                                    </th>
                                    <th>Registration</th>
                                    <th>Vehicle</th>
                                    <th>MOT Expiry</th>
                                    <th>Days Until/Since</th>
                                    <th>Urgency</th>
                                    <th>Customer</th>
                                    <th>Reminder Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="reminders-table">
                                <!-- Reminders will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Settings Page -->
                <div class="page" id="settings-page" style="display: none;">
                    <!-- Page Header -->
                    <div class="apple-page-header">
                        <h1 class="apple-page-title">
                            <i class="fas fa-cog" style="color: var(--apple-blue); margin-right: 12px;"></i>
                            Settings
                        </h1>
                        <p class="apple-page-subtitle">Configure your MOT reminder system</p>
                    </div>

                    <!-- Settings Grid -->
                    <div class="apple-grid apple-grid-2" style="margin-bottom: var(--apple-spacing-lg);">
                        <!-- Email Settings -->
                        <div class="apple-card">
                            <div class="apple-card-header">
                                <h2 class="apple-card-title">
                                    <i class="fas fa-envelope" style="color: var(--apple-blue);"></i>
                                    Email Settings
                                </h2>
                            </div>
                            <div class="apple-card-body">
                                <form id="email-settings-form">
                                    <div class="apple-form-group">
                                        <label for="smtp-server" class="apple-label">SMTP Server</label>
                                        <input type="text" class="apple-input" id="smtp-server" placeholder="smtp.example.com">
                                    </div>
                                    <div class="apple-form-group">
                                        <label for="smtp-port" class="apple-label">SMTP Port</label>
                                        <input type="number" class="apple-input" id="smtp-port" placeholder="587">
                                    </div>
                                    <div class="apple-form-group">
                                        <label for="smtp-username" class="apple-label">SMTP Username</label>
                                        <input type="text" class="apple-input" id="smtp-username" placeholder="user@example.com">
                                    </div>
                                    <div class="apple-form-group">
                                        <label for="smtp-password" class="apple-label">SMTP Password</label>
                                        <input type="password" class="apple-input" id="smtp-password">
                                    </div>
                                    <div class="apple-form-group">
                                        <label for="sender-email" class="apple-label">Sender Email</label>
                                        <input type="email" class="apple-input" id="sender-email" placeholder="garage@example.com">
                                    </div>
                                    <button type="submit" class="apple-btn apple-btn-primary">Save Email Settings</button>
                                </form>
                            </div>
                        </div>

                        <!-- SMS Settings -->
                        <div class="apple-card">
                            <div class="apple-card-header">
                                <h2 class="apple-card-title">
                                    <i class="fas fa-sms" style="color: var(--apple-green);"></i>
                                    SMS Settings
                                </h2>
                            </div>
                            <div class="apple-card-body">
                                <form id="sms-settings-form">
                                    <div class="apple-form-group">
                                        <label for="sms-api-url" class="apple-label">SMS API URL</label>
                                        <input type="text" class="apple-input" id="sms-api-url" placeholder="https://api.sms-provider.com">
                                    </div>
                                    <div class="apple-form-group">
                                        <label for="sms-api-key" class="apple-label">SMS API Key</label>
                                        <input type="text" class="apple-input" id="sms-api-key">
                                    </div>
                                    <div class="apple-form-group">
                                        <label for="sms-sender-id" class="apple-label">SMS Sender ID</label>
                                        <input type="text" class="apple-input" id="sms-sender-id" placeholder="GarageReminder">
                                    </div>
                                    <button type="submit" class="apple-btn apple-btn-primary">Save SMS Settings</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <!-- Templates Section -->
                    <div class="apple-grid apple-grid-2" style="margin-bottom: var(--apple-spacing-lg);">
                        <!-- Email Template -->
                        <div class="apple-card">
                            <div class="apple-card-header">
                                <h2 class="apple-card-title">
                                    <i class="fas fa-file-alt" style="color: var(--apple-blue);"></i>
                                    Email Template
                                </h2>
                            </div>
                            <div class="apple-card-body">
                                <form id="email-template-form">
                                    <div class="apple-form-group">
                                        <textarea class="apple-textarea" id="email-template" rows="10" placeholder="Enter your email template here..."></textarea>
                                        <div class="apple-form-help">Available placeholders: {customer_name}, {vehicle_make}, {vehicle_model}, {vehicle_registration}, {mot_expiry_date}</div>
                                    </div>
                                    <button type="submit" class="apple-btn apple-btn-primary">Save Email Template</button>
                                </form>
                            </div>
                        </div>

                        <!-- SMS Template -->
                        <div class="apple-card">
                            <div class="apple-card-header">
                                <h2 class="apple-card-title">
                                    <i class="fas fa-comment" style="color: var(--apple-green);"></i>
                                    SMS Template
                                </h2>
                            </div>
                            <div class="apple-card-body">
                                <form id="sms-template-form">
                                    <div class="apple-form-group">
                                        <textarea class="apple-textarea" id="sms-template" rows="5" placeholder="Enter your SMS template here..."></textarea>
                                        <div class="apple-form-help">Available placeholders: {customer_name}, {vehicle_make}, {vehicle_model}, {vehicle_registration}, {mot_expiry_date}</div>
                                    </div>
                                    <button type="submit" class="apple-btn apple-btn-primary">Save SMS Template</button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- DVLA Settings -->
                    <div class="apple-card">
                        <div class="apple-card-header">
                            <h2 class="apple-card-title">
                                <i class="fas fa-car" style="color: var(--apple-orange);"></i>
                                DVLA API Settings
                            </h2>
                        </div>
                        <div class="apple-card-body">
                            <form id="dvla-settings-form">
                                <div class="apple-form-group">
                                    <label for="dvla-client-id" class="apple-label">Client ID</label>
                                    <input type="text" class="apple-input" id="dvla-client-id" value="2b3911f4-55f5-4a86-a9f0-0fc02c2bff0f">
                                </div>
                                <div class="apple-form-group">
                                    <label for="dvla-client-secret" class="apple-label">Client Secret</label>
                                    <input type="password" class="apple-input" id="dvla-client-secret" value="rWe8Q~vhlVo7Z_fFuy~zBfAOY5BqCg_PviCwIa74">
                                </div>
                                <div class="apple-form-group">
                                    <label for="dvla-api-key" class="apple-label">API Key</label>
                                    <input type="text" class="apple-input" id="dvla-api-key" value="8TfF8vnU2s5sP1CRm7ij69anVlLe5SRm4cNGn9yq">
                                </div>
                                <button type="submit" class="apple-btn apple-btn-primary">Save DVLA Settings</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Job Sheets Page -->
                <div class="page" id="job-sheets-page" style="display: none;">
                    <!-- Page Header -->
                    <div class="apple-page-header">
                        <h1 class="apple-page-title">
                            <i class="fas fa-file-invoice" style="color: var(--apple-blue); margin-right: 12px;"></i>
                            GA4 Job Sheets
                        </h1>
                        <p class="apple-page-subtitle">Manage job sheets and analytics with DVLA integration</p>
                    </div>

                    <!-- Action Bar -->
                    <div class="apple-action-bar">
                        <div class="apple-action-group">
                            <button class="apple-btn apple-btn-secondary" id="upload-job-sheets-btn">
                                <i class="bi bi-upload"></i> Upload Job Sheets
                            </button>
                            <button class="apple-btn apple-btn-secondary" id="link-job-data-btn">
                                <i class="bi bi-link"></i> Link Data
                            </button>
                            <a href="/batch-verification" class="apple-btn apple-btn-success">
                                <i class="fas fa-sync-alt"></i> Batch DVLA Verification
                            </a>
                        </div>
                        <div class="apple-action-group">
                            <button class="apple-btn apple-btn-danger" id="clear-all-job-sheets-btn">
                                <i class="bi bi-trash"></i> Clear All
                            </button>
                            <button class="apple-btn apple-btn-primary" id="view-analytics-btn">
                                <i class="bi bi-graph-up"></i> Analytics
                            </button>
                        </div>
                    </div>

                    <!-- Job Sheets Upload Section -->
                    <div class="apple-card" id="job-sheets-upload-section" style="display: none; margin-bottom: var(--apple-spacing-lg);">
                        <div class="apple-card-header">
                            <h2 class="apple-card-title">
                                <i class="fas fa-cloud-upload-alt" style="color: var(--apple-blue);"></i>
                                Bulk Upload GA4 Files (CSV/Excel)
                            </h2>
                        </div>
                        <div class="apple-card-body">
                            <div class="apple-form-group">
                                <input type="file" class="apple-input" id="job-sheets-file-input" accept=".csv,.xlsx,.xls" multiple>
                                <div class="apple-form-help">
                                    <strong>🚀 Multi-File GA4 Integration:</strong><br>
                                    • <strong>Select multiple files:</strong> Hold Ctrl/Cmd to select multiple files at once<br>
                                    • <strong>Supported formats:</strong> CSV (.csv) and Excel (.xlsx, .xls)<br>
                                    • <strong>Auto-detection:</strong> System automatically detects file types (customers, vehicles, job sheets, etc.)<br>
                                    • <strong>Smart processing:</strong> Files processed in optimal order for data linking<br>
                                    • <strong>DVLA integration:</strong> Automatic vehicle lookup during processing<br>
                                    • <strong>Duplicate handling:</strong> Updates existing records, creates new ones as needed
                                </div>
                            </div>

                            <!-- File List Display -->
                            <div id="selected-files-list" style="display: none; margin-bottom: var(--apple-spacing-md);">
                                <h6 style="margin-bottom: var(--apple-spacing-sm);"><i class="fas fa-list"></i> Selected Files:</h6>
                                <div id="files-preview" style="border: 1px solid var(--apple-separator); border-radius: var(--apple-radius-medium); padding: var(--apple-spacing-md); background: var(--apple-bg-secondary);">
                                    <!-- Selected files will be shown here -->
                                </div>
                            </div>

                            <!-- Processing Options -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--apple-spacing-md); margin-bottom: var(--apple-spacing-md);">
                                <div class="apple-checkbox">
                                    <input type="checkbox" id="auto-dvla-lookup" checked>
                                    <label for="auto-dvla-lookup">
                                        <i class="fas fa-search"></i> Auto DVLA Lookup
                                    </label>
                                </div>
                                <div class="apple-checkbox">
                                    <input type="checkbox" id="auto-link-data" checked>
                                    <label for="auto-link-data">
                                        <i class="fas fa-link"></i> Auto Link Data
                                    </label>
                                </div>
                            </div>

                            <!-- Progress Bar -->
                            <div id="upload-progress" style="display: none; margin-bottom: var(--apple-spacing-md);">
                                <div style="display: flex; justify-content: space-between; margin-bottom: var(--apple-spacing-xs);">
                                    <span id="progress-text">Processing files...</span>
                                    <span id="progress-percentage">0%</span>
                                </div>
                                <div style="background: var(--apple-separator); border-radius: var(--apple-radius-medium); height: 8px; overflow: hidden;">
                                    <div id="progress-bar" style="background: var(--apple-blue); height: 100%; width: 0%; transition: width 0.3s ease; border-radius: var(--apple-radius-medium);"></div>
                                </div>
                            </div>

                            <div style="display: flex; gap: var(--apple-spacing-sm);">
                                <button class="apple-btn apple-btn-primary" id="process-job-sheets-btn">
                                    <i class="fas fa-rocket"></i> Process All Files
                                </button>
                                <button class="apple-btn apple-btn-secondary" id="cancel-job-sheets-btn">Cancel</button>
                                <button class="apple-btn apple-btn-secondary" id="clear-files-btn" style="display: none;">
                                    <i class="fas fa-times"></i> Clear Selection
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Summary -->
                    <div class="apple-grid apple-grid-4" id="job-sheets-analytics" style="margin-bottom: var(--apple-spacing-lg);">
                        <div class="apple-card">
                            <div class="apple-card-body" style="text-align: center;">
                                <div style="font-size: 48px; font-weight: var(--apple-font-weight-bold); color: var(--apple-blue); margin-bottom: var(--apple-spacing-sm);" id="total-jobs-count">0</div>
                                <div style="color: var(--apple-text-secondary);">
                                    <i class="fas fa-file-invoice"></i> Total Jobs
                                </div>
                            </div>
                        </div>
                        <div class="apple-card">
                            <div class="apple-card-body" style="text-align: center;">
                                <div style="font-size: 48px; font-weight: var(--apple-font-weight-bold); color: var(--apple-green); margin-bottom: var(--apple-spacing-sm);" id="total-revenue">£0</div>
                                <div style="color: var(--apple-text-secondary);">
                                    <i class="fas fa-pound-sign"></i> Total Revenue
                                </div>
                            </div>
                        </div>
                        <div class="apple-card">
                            <div class="apple-card-body" style="text-align: center;">
                                <div style="font-size: 48px; font-weight: var(--apple-font-weight-bold); color: var(--apple-orange); margin-bottom: var(--apple-spacing-sm);" id="mot-jobs-count">0</div>
                                <div style="color: var(--apple-text-secondary);">
                                    <i class="fas fa-car"></i> MOT Jobs
                                </div>
                            </div>
                        </div>
                        <div class="apple-card">
                            <div class="apple-card-body" style="text-align: center;">
                                <div style="font-size: 48px; font-weight: var(--apple-font-weight-bold); color: var(--apple-purple); margin-bottom: var(--apple-spacing-sm);" id="payment-rate">0%</div>
                                <div style="color: var(--apple-text-secondary);">
                                    <i class="fas fa-credit-card"></i> Payment Rate
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="apple-filter-bar" id="job-sheets-filters">
                        <div class="apple-filter-grid">
                            <div class="apple-filter-group">
                                <label class="apple-filter-label">Customer</label>
                                <input type="text" class="apple-input" id="search-customer" placeholder="Search customer...">
                            </div>
                            <div class="apple-filter-group">
                                <label class="apple-filter-label">Registration</label>
                                <input type="text" class="apple-input" id="search-vehicle-reg" placeholder="Search registration...">
                            </div>
                            <div class="apple-filter-group">
                                <label class="apple-filter-label">From Date</label>
                                <input type="date" class="apple-input" id="date-from">
                            </div>
                            <div class="apple-filter-group">
                                <label class="apple-filter-label">To Date</label>
                                <input type="date" class="apple-input" id="date-to">
                            </div>
                            <div class="apple-filter-group" style="display: flex; align-items: end;">
                                <button class="apple-btn apple-btn-secondary" id="clear-job-filters">
                                    <i class="bi bi-x"></i> Clear
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Job Sheets Table -->
                    <div class="apple-table-container">
                        <table class="apple-table apple-table-compact">
                            <thead>
                                <tr>
                                    <th>Doc No</th>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Vehicle</th>
                                    <th>Registration</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Links</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="job-sheets-table">
                                <!-- Job sheets will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add/Edit Vehicle Modal -->
    <div class="modal fade" id="vehicle-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="vehicle-modal-title">Add Vehicle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="vehicle-form">
                        <input type="hidden" id="vehicle-id">
                        <div class="mb-3">
                            <label for="vehicle-registration" class="form-label">Registration</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="vehicle-registration" required>
                                <button class="btn btn-outline-secondary" type="button" id="lookup-vehicle-btn">Lookup</button>
                            </div>
                            <div class="mt-2">
                                <input type="file" class="form-control" id="ocr-image-upload" accept="image/*" style="display: none;">
                                <button class="btn btn-outline-primary btn-sm" type="button" id="upload-image-btn">
                                    <i class="bi bi-camera"></i> Upload Image for OCR
                                </button>
                                <small class="form-text text-muted">Upload an image of a registration plate to extract the number automatically</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="vehicle-make" class="form-label">Make</label>
                            <input type="text" class="form-control" id="vehicle-make">
                        </div>
                        <div class="mb-3">
                            <label for="vehicle-model" class="form-label">Model</label>
                            <input type="text" class="form-control" id="vehicle-model">
                        </div>
                        <div class="mb-3">
                            <label for="vehicle-color" class="form-label">Color</label>
                            <input type="text" class="form-control" id="vehicle-color">
                        </div>
                        <div class="mb-3">
                            <label for="vehicle-year" class="form-label">Year</label>
                            <input type="number" class="form-control" id="vehicle-year">
                        </div>
                        <div class="mb-3">
                            <label for="vehicle-mot-expiry" class="form-label">MOT Expiry</label>
                            <input type="date" class="form-control" id="vehicle-mot-expiry">
                        </div>
                        <div class="mb-3">
                            <label for="vehicle-customer" class="form-label">Customer</label>
                            <select class="form-select" id="vehicle-customer">
                                <option value="">Select Customer</option>
                                <!-- Customers will be loaded here -->
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-vehicle-btn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Customer Modal -->
    <div class="modal fade" id="customer-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customer-modal-title">Add Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="customer-form">
                        <input type="hidden" id="customer-id">
                        <div class="mb-3">
                            <label for="customer-name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="customer-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="customer-email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="customer-email">
                        </div>
                        <div class="mb-3">
                            <label for="customer-phone" class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="customer-phone">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-customer-btn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Reminder Modal -->
    <div class="modal fade" id="reminder-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reminder-modal-title">Add Reminder</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="reminder-form">
                        <input type="hidden" id="reminder-id">
                        <div class="mb-3">
                            <label for="reminder-vehicle" class="form-label">Vehicle</label>
                            <select class="form-select" id="reminder-vehicle" required>
                                <option value="">Select Vehicle</option>
                                <!-- Vehicles will be loaded here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="reminder-date" class="form-label">Reminder Date</label>
                            <input type="date" class="form-control" id="reminder-date" required>
                        </div>
                        <div class="mb-3">
                            <label for="reminder-status" class="form-label">Status</label>
                            <select class="form-select" id="reminder-status">
                                <option value="scheduled">Scheduled</option>
                                <option value="sent">Sent</option>
                                <option value="failed">Failed</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-reminder-btn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Job Sheet Details Modal -->
    <div class="modal fade" id="job-sheet-details-modal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="job-sheet-details-title">Job Sheet Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Job Sheet Header Info -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0"><i class="fas fa-file-invoice"></i> Job Sheet Information</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <strong>Document Number:</strong><br>
                                            <span id="job-doc-no" class="text-primary fs-5"></span>
                                        </div>
                                        <div class="col-md-3">
                                            <strong>Date Created:</strong><br>
                                            <span id="job-date-created"></span>
                                        </div>
                                        <div class="col-md-3">
                                            <strong>Document Type:</strong><br>
                                            <span id="job-doc-type" class="badge bg-info"></span>
                                        </div>
                                        <div class="col-md-3">
                                            <strong>Status:</strong><br>
                                            <span id="job-status-badge"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Customer & Vehicle Info -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-user"></i> Customer Information</h6>
                                </div>
                                <div class="card-body" id="job-customer-info">
                                    <!-- Customer data will be populated here -->
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-car"></i> Vehicle Information</h6>
                                </div>
                                <div class="card-body" id="job-vehicle-info">
                                    <!-- Vehicle data will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabbed Content -->
                    <div class="card">
                        <div class="card-header p-0">
                            <ul class="nav nav-tabs card-header-tabs" id="job-details-tabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="financial-tab" data-bs-toggle="tab" data-bs-target="#financial-content" type="button" role="tab">
                                        <i class="fas fa-pound-sign"></i> Financial
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="parts-tab" data-bs-toggle="tab" data-bs-target="#parts-content" type="button" role="tab">
                                        <i class="fas fa-cogs"></i> Parts & Labour
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="mot-tab" data-bs-toggle="tab" data-bs-target="#mot-content" type="button" role="tab">
                                        <i class="fas fa-certificate"></i> MOT Details
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history-content" type="button" role="tab">
                                        <i class="fas fa-history"></i> History
                                    </button>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content" id="job-details-tab-content">
                                <!-- Financial Tab -->
                                <div class="tab-pane fade show active" id="financial-content" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6>Totals</h6>
                                            <table class="table table-sm">
                                                <tr><td>Subtotal:</td><td class="text-end" id="job-subtotal">£0.00</td></tr>
                                                <tr><td>VAT:</td><td class="text-end" id="job-vat">£0.00</td></tr>
                                                <tr class="table-primary"><td><strong>Grand Total:</strong></td><td class="text-end"><strong id="job-grand-total">£0.00</strong></td></tr>
                                            </table>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Payment Information</h6>
                                            <table class="table table-sm">
                                                <tr><td>Date Paid:</td><td id="job-date-paid">Not paid</td></tr>
                                                <tr><td>Payment Method:</td><td id="job-payment-method">-</td></tr>
                                                <tr><td>Balance:</td><td class="text-end" id="job-balance">£0.00</td></tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <!-- Parts & Labour Tab -->
                                <div class="tab-pane fade" id="parts-content" role="tabpanel">
                                    <div id="job-parts-labour-content">
                                        <!-- Parts and labour details will be populated here -->
                                    </div>
                                </div>

                                <!-- MOT Tab -->
                                <div class="tab-pane fade" id="mot-content" role="tabpanel">
                                    <div id="job-mot-details">
                                        <!-- MOT specific details will be populated here -->
                                    </div>
                                </div>

                                <!-- History Tab -->
                                <div class="tab-pane fade" id="history-content" role="tabpanel">
                                    <div id="job-history-content">
                                        <!-- Job history will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="edit-job-sheet-btn">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button type="button" class="btn btn-success" id="print-job-sheet-btn">
                        <i class="fas fa-print"></i> Print
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- CSV Results Modal -->
    <div class="modal fade" id="csv-results-modal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">CSV Upload Results</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="csv-results-content">
                        <!-- Results will be populated here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vehicle Details Modal -->
    <div class="modal fade" id="vehicle-details-modal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="vehicle-details-title">Vehicle Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Vehicle Information -->
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="bi bi-car-front"></i> Vehicle Information (Garage Records)</h6>
                                </div>
                                <div class="card-body" id="vehicle-info">
                                    <!-- Vehicle data will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Customer Information -->
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="bi bi-person"></i> Customer Information</h6>
                                </div>
                                <div class="card-body" id="customer-info">
                                    <!-- Customer data will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DVLA Information -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="bi bi-shield-check"></i> DVLA Official Data</h6>
                                </div>
                                <div class="card-body" id="dvla-info">
                                    <!-- DVLA data will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MOT History -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-history"></i> DVLA MOT History</h6>
                                </div>
                                <div class="card-body" id="vehicle-mot-history">
                                    <div class="text-center">
                                        <div class="ai-loading"></div>
                                        <p class="mt-2">Loading MOT history from DVLA...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MOT Reminders -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0"><i class="bi bi-calendar-check"></i> MOT Reminders</h6>
                                    <button class="btn btn-sm btn-primary" id="add-reminder-for-vehicle">
                                        <i class="bi bi-plus"></i> Add Reminder
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Reminder Date</th>
                                                    <th>Status</th>
                                                    <th>Created</th>
                                                    <th>Sent</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="vehicle-reminders-table">
                                                <!-- Reminders will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="edit-vehicle-from-details">Edit Vehicle</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reminder Details Modal -->
    <div class="modal fade" id="reminder-details-modal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reminder-details-title">Reminder Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Reminder Information -->
                        <div class="col-md-12">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="bi bi-calendar-check"></i> Reminder Information</h6>
                                </div>
                                <div class="card-body" id="reminder-details-info">
                                    <!-- Reminder data will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Vehicle Information -->
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="bi bi-car-front"></i> Vehicle Information</h6>
                                </div>
                                <div class="card-body" id="reminder-vehicle-info">
                                    <!-- Vehicle data will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Customer Information -->
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="bi bi-person"></i> Customer Information</h6>
                                </div>
                                <div class="card-body" id="reminder-customer-info">
                                    <!-- Customer data will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DVLA Information -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="bi bi-shield-check"></i> DVLA Official Data</h6>
                                </div>
                                <div class="card-body" id="reminder-dvla-info">
                                    <!-- DVLA data will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MOT History -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-history"></i> DVLA MOT History</h6>
                                </div>
                                <div class="card-body" id="reminder-mot-history">
                                    <div class="text-center">
                                        <div class="ai-loading"></div>
                                        <p class="mt-2">Loading MOT history from DVLA...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning" id="edit-reminder-from-details">
                        <i class="bi bi-pencil"></i> Edit Reminder
                    </button>
                    <button type="button" class="btn btn-success" id="send-reminder-from-details">
                        <i class="bi bi-send"></i> Send Reminder
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-message">
                <!-- Toast message will be set dynamically -->
            </div>
        </div>
    </div>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="theme-toggle" title="Toggle Light/Dark Theme">
        <i class="fas fa-sun"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Simple direct navigation function
        function showPageDirect(page) {
            console.log('Direct navigation to:', page);

            // Hide all pages
            document.querySelectorAll('.page').forEach(p => {
                p.style.display = 'none';
            });

            // Show selected page
            const targetPage = document.getElementById(`${page}-page`);
            if (targetPage) {
                targetPage.style.display = 'block';
                console.log('Successfully showed page:', page);
            } else {
                console.error('Page not found:', `${page}-page`);
            }

            // Update active nav link
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
            });
            const activeLink = document.querySelector(`[data-page="${page}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }

            // Load page data if main.js is loaded
            if (typeof loadDashboard === 'function') {
                switch(page) {
                    case 'dashboard':
                        loadDashboard();
                        break;
                    case 'vehicles':
                        loadVehicles();
                        break;
                    case 'customers':
                        loadCustomers();
                        break;
                    case 'reminders':
                        loadRemindersEnhanced();
                        break;
                    case 'job-sheets':
                        loadJobSheets();
                        break;
                    case 'settings':
                        loadSettings();
                        break;
                }
            }
        }

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error);
            document.body.style.visibility = 'visible';
            document.body.style.opacity = '1';
        });

        // Ensure page is visible after 1 second regardless of JavaScript
        setTimeout(function() {
            document.body.style.visibility = 'visible';
            document.body.style.opacity = '1';
            console.log('Forced page visibility');
        }, 1000);
    </script>
    <script src="/js/main.js?v=2024010204"></script>
</body>
</html>
